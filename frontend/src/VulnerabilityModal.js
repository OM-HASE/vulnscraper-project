import React from 'react';

function VulnerabilityModal({ vuln, onClose }) {
  if (!vuln) return null;
  return (
    <div style={{
      position:'fixed',top:0,left:0,right:0,bottom:0,
      background:'rgba(0,0,0,0.7)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:1000,
      padding: '20px'
    }}>
      <div style={{
        background:'#fff',
        padding:'24px',
        borderRadius:'8px',
        maxWidth:'600px',
        maxHeight:'80vh',
        width:'90%',
        position:'relative',
        boxShadow:'0 4px 20px rgba(0,0,0,0.3)',
        overflowY:'auto'
      }}>
        <button
          onClick={onClose}
          style={{
            position:'absolute',
            top:'12px',
            right:'12px',
            background:'#f44336',
            color:'white',
            border:'none',
            borderRadius:'50%',
            width:'32px',
            height:'32px',
            cursor:'pointer',
            fontSize:'16px',
            display:'flex',
            alignItems:'center',
            justifyContent:'center'
          }}
        >
          Ã—
        </button>

        <h2 style={{
          marginTop:0,
          marginBottom:'16px',
          color:'#333',
          fontSize:'1.5em',
          borderBottom:'2px solid #007bff',
          paddingBottom:'8px'
        }}>
          {vuln.title}
        </h2>

        <div style={{marginBottom:'16px'}}>
          <div style={{marginBottom:'8px'}}>
            <strong style={{color:'#007bff'}}>CVE:</strong> {vuln.cve}
          </div>
          <div style={{marginBottom:'8px'}}>
            <strong style={{color:'#007bff'}}>Severity:</strong>
            <span style={{
              backgroundColor: vuln.severity === 'Critical' ? '#dc3545' :
                              vuln.severity === 'High' ? '#fd7e14' :
                              vuln.severity === 'Medium' ? '#ffc107' : '#28a745',
              color:'white',
              padding:'2px 8px',
              borderRadius:'4px',
              marginLeft:'8px'
            }}>
              {vuln.severity} ({vuln.cvss || 'N/A'})
            </span>
          </div>
          <div style={{marginBottom:'8px'}}>
            <strong style={{color:'#007bff'}}>Vendor/Product:</strong> {vuln.vendor || 'Unknown'} {vuln.product || ''}
          </div>
          <div style={{marginBottom:'8px'}}>
            <strong style={{color:'#007bff'}}>Status:</strong> {vuln.status}
          </div>
          <div style={{marginBottom:'8px'}}>
            <strong style={{color:'#007bff'}}>Published:</strong> {vuln.published ? new Date(vuln.published).toLocaleDateString() : 'N/A'}
          </div>
        </div>

        {vuln.description && (
          <div style={{marginBottom:'16px'}}>
            <strong style={{color:'#007bff'}}>Description:</strong>
            <p style={{
              margin:'8px 0',
              lineHeight:'1.5',
              color:'#555',
              textAlign:'justify'
            }}>
              {vuln.description}
            </p>
          </div>
        )}

        {/* New addition: Mitigations and Important URL buttons */}
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '16px' }}>
          <button 
            onClick={() => alert(vuln.mitigations || 'No mitigations info available')}
            style={{
              padding: '6px 12px',
              border: '1px solid #007bff',
              backgroundColor: '#007bff',
              color: 'white',
              borderRadius: '4px',
              cursor: 'pointer'
            }}
          >
            Mitigations
          </button>
          {vuln.references && vuln.references.length > 0 ? (
            <a 
              href={vuln.references[0]} 
              target="_blank" 
              rel="noopener noreferrer"
              style={{
                padding: '6px 12px',
                border: '1px solid #007bff',
                backgroundColor: '#007bff',
                color: 'white',
                borderRadius: '4px',
                textDecoration: 'none',
                display: 'inline-block',
                textAlign: 'center',
                lineHeight: '20px'
              }}
            >
              Important URL
            </a>
          ) : (
            <button 
              disabled 
              style={{
                padding: '6px 12px',
                border: '1px solid grey',
                backgroundColor: 'lightgrey',
                color: 'darkgrey',
                borderRadius: '4px',
                cursor: 'not-allowed'
              }}
            >
              Important URL
            </button>
          )}
        </div>

        {vuln.references && vuln.references.length > 0 && (
          <div style={{marginBottom:'16px'}}>
            <strong style={{color:'#007bff'}}>References:</strong>
            <ul style={{margin:'8px 0', paddingLeft:'20px'}}>
              {vuln.references.slice(0, 5).map((ref, index) =>
                <li key={index} style={{marginBottom:'4px'}}>
                  <a
                    href={ref}
                    target="_blank"
                    rel="noreferrer"
                    style={{color:'#007bff', textDecoration:'none'}}
                  >
                    {ref.length > 60 ? ref.substring(0, 60) + '...' : ref}
                  </a>
                </li>
              )}
              {vuln.references.length > 5 && (
                <li style={{fontStyle:'italic', color:'#666'}}>
                  ... and {vuln.references.length - 5} more references
                </li>
              )}
            </ul>
          </div>
        )}

        {vuln.impact && (
          <div style={{marginBottom:'16px'}}>
            <strong style={{color:'#007bff'}}>Impact:</strong>
            <div style={{marginTop:'8px'}}>
              <div style={{marginBottom:'4px'}}>
                <strong>Confidentiality:</strong> {vuln.impact.confidentiality}
              </div>
              <div style={{marginBottom:'4px'}}>
                <strong>Integrity:</strong> {vuln.impact.integrity}
              </div>
              <div style={{marginBottom:'4px'}}>
                <strong>Availability:</strong> {vuln.impact.availability}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default VulnerabilityModal;
